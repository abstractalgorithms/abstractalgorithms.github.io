(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3670],{24132:function(e,t,r){Promise.resolve().then(r.bind(r,37963))},37963:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(57437),o=r(84603),s=r(2265);function a(){let{user:e,userProfile:t,loading:r,signUp:a,signIn:i}=(0,o.a)(),[l,u]=(0,s.useState)(null),c=async()=>{try{console.log("\uD83E\uDDEA Testing Firebase connection..."),e?(console.log("\uD83D\uDD0D Testing user profile via server..."),u({user:{uid:e.uid,email:e.email,displayName:e.displayName},userProfile:t,timestamp:new Date().toISOString()}),console.log("✅ Debug info updated:",l)):u({error:"No user logged in",timestamp:new Date().toISOString()})}catch(e){console.error("❌ Firebase test failed:",e),u({error:e.message,timestamp:new Date().toISOString()})}},d=async()=>{try{console.log("\uD83E\uDDEA Testing sign in with test@example.com..."),await i("test@example.com","password123"),console.log("✅ Sign in successful!")}catch(e){console.error("❌ Sign in failed:",e),u({error:"Sign in failed: ".concat(e.message),timestamp:new Date().toISOString()})}},g=async()=>{try{console.log("\uD83E\uDDEA Testing sign up..."),await a("test@example.com","password123","Test User"),console.log("✅ Sign up successful!")}catch(e){console.error("❌ Sign up failed:",e),u({error:"Sign up failed: ".concat(e.message),timestamp:new Date().toISOString()})}};return r?(0,n.jsx)("div",{className:"p-4 bg-yellow-100 border border-yellow-400 rounded",children:(0,n.jsx)("h3",{className:"font-bold",children:"Auth Loading..."})}):(0,n.jsxs)("div",{className:"p-4 bg-blue-100 border border-blue-400 rounded mb-4",children:[(0,n.jsx)("h3",{className:"font-bold mb-2",children:"\uD83D\uDD0D Firebase Auth Debugger"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User:"})," ",e?e.email:"Not logged in"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"User Profile:"})," ",t?JSON.stringify(t.role):"No profile"]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("strong",{children:"Loading:"})," ",r?"Yes":"No"]})]}),"      ",(0,n.jsx)("button",{onClick:d,className:"mt-2 px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600 mr-2",children:"\uD83D\uDD11 Sign In Test User"}),(0,n.jsx)("button",{onClick:c,className:"mt-2 px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 mr-2",children:"\uD83E\uDDEA Test Firebase Connection"}),(0,n.jsx)("button",{onClick:g,className:"mt-2 px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",children:"\uD83D\uDC64 Test Sign Up"}),l&&(0,n.jsxs)("div",{className:"mt-3 p-2 bg-gray-100 rounded text-xs",children:[(0,n.jsx)("h4",{className:"font-bold",children:"Debug Results:"}),(0,n.jsx)("pre",{children:JSON.stringify(l,null,2)})]})]})}function i(){return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,n.jsx)("div",{className:"container mx-auto px-4",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"\uD83D\uDD27 Firebase Debug Console"}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:"This page is for development and debugging purposes only. Use it to test Firebase authentication, Firestore connections, and user management."}),(0,n.jsx)(a,{}),(0,n.jsxs)("div",{className:"mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-semibold text-yellow-800 mb-2",children:"⚠️ Development Only"}),(0,n.jsx)("p",{className:"text-yellow-700 text-sm",children:"This debug interface should not be accessible in production. Remove or protect this route before deploying to production."})]})]})})})}},84603:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return c},a:function(){return d}});var n=r(57437),o=r(2265),s=r(43301),a=r(46410),i=r(99764),l=r(40257);let u=(0,o.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,o.useState)(null),[d,g]=(0,o.useState)(null),[h,m]=(0,o.useState)(!0),D=async e=>{try{var t,r;console.log("\uD83D\uDD0D Loading user profile for UID:",e.uid);let n=await e.getIdToken();try{let t=await i.G.getUserProfile(e.uid,n);if(t){console.log("\uD83D\uDCCB Profile data loaded from server:",t),g(t);return}}catch(e){console.warn("⚠️ Server unavailable, using fallback profile:",e)}console.log("\uD83D\uDD04 Creating fallback local profile...");let o=(null===(t=e.email)||void 0===t?void 0:t.includes("admin"))||(null===(r=e.email)||void 0===r?void 0:r.includes("test")),s={uid:e.uid,email:e.email,displayName:e.displayName||e.email.split("@")[0],role:o?"admin":"user",createdAt:new Date,updatedAt:new Date};g(s),console.log("✅ Fallback profile created:",s)}catch(e){console.error("❌ Error loading user profile:",e)}};(0,o.useEffect)(()=>{if(console.log("\uD83D\uDD25 Firebase config:",{configured:a.Wn,apiKey:l.env.NEXT_PUBLIC_FIREBASE_API_KEY?"loaded":"missing",authDomain:l.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN?"loaded":"missing",projectId:l.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID?"loaded":"missing"}),!a.Wn||!a.I8){console.log("⚠️ Firebase not configured, auth will be disabled"),m(!1);return}let e=(0,s.Aj)(a.I8,async e=>{console.log("\uD83D\uDD04 Auth state changed:",e?"User logged in: ".concat(e.email):"User logged out"),c(e),e?(console.log("\uD83D\uDD04 Loading profile for authenticated user..."),await D(e)):(console.log("\uD83D\uDD04 Clearing user profile..."),g(null)),m(!1)});return()=>e()},[]);let f=async(e,t)=>{if(!a.Wn||!a.I8)throw Error("Firebase authentication is not configured");try{console.log("\uD83D\uDD10 useAuth: Starting sign in process for:",e);let r=await (0,s.e5)(a.I8,e,t);console.log("✅ useAuth: Firebase sign in successful:",r.user.uid)}catch(e){throw console.error("❌ useAuth: Sign in failed:",e),Error(e.message)}},p=async(e,t,r)=>{if(!a.Wn||!a.I8)throw Error("Firebase authentication is not configured");try{let{user:n}=await (0,s.Xb)(a.I8,e,t);await (0,s.ck)(n,{displayName:r});let o=await n.getIdToken();await i.G.createUserProfile(n.uid,{email:e,displayName:r,role:"user"},o)}catch(e){throw Error(e.message)}},b=async()=>{if(!a.Wn||!a.I8){console.log("⚠️ Firebase not configured, clearing local state"),c(null),g(null);return}try{await (0,s.w7)(a.I8)}catch(e){throw Error(e.message)}},y=async e=>{if(!a.Wn||!a.I8)throw Error("Firebase authentication is not configured");try{await (0,s.LS)(a.I8,e)}catch(e){throw Error(e.message)}},E=async e=>{if(!r)throw Error("No user authenticated");if(!a.Wn||!a.I8)throw Error("Firebase authentication is not configured");try{let t=await r.getIdToken();if(!await i.G.updateUserProfile(r.uid,e,t))throw Error("Failed to update profile on server");e.displayName&&await (0,s.ck)(r,{displayName:e.displayName}),g(t=>t?{...t,...e,updatedAt:new Date}:null)}catch(e){throw Error(e.message)}};return(0,n.jsx)(u.Provider,{value:{user:r,userProfile:d,loading:h,signIn:f,signUp:p,logout:b,resetPassword:y,updateUserProfile:E,hasPermission:e=>!!d&&(({admin:["create","read","update","delete","manage_users"],editor:["create","read","update"],contributor:["create","read"],reader:["read"]})[d.role]||[]).includes(e)},children:t})}function d(){let e=(0,o.useContext)(u);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},46410:function(e,t,r){"use strict";r.d(t,{I8:function(){return c},Wn:function(){return l},db:function(){return d}});var n=r(738),o=r(43301),s=r(5978),a=r(40257);let i={apiKey:a.env.NEXT_PUBLIC_FIREBASE_API_KEY||"dummy-api-key",authDomain:a.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"dummy-project.firebaseapp.com",projectId:a.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"dummy-project"},l=!!(a.env.NEXT_PUBLIC_FIREBASE_API_KEY&&a.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN&&a.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID),u=null,c=null,d=null;try{u=0===(0,n.C6)().length?(0,n.ZF)(i):(0,n.C6)()[0],c=(0,o.v0)(u),d=(0,s.ad)(u),console.log("\uD83D\uDD25 Firebase initialized:",{configured:l,environment:"production"})}catch(e){console.warn("⚠️ Firebase initialization failed:",e),console.log("\uD83D\uDD27 This is normal during build time or when Firebase env vars are missing"),c=null,d=null}},99764:function(e,t,r){"use strict";r.d(t,{G:function(){return s}});var n=r(40257);class o{getServerUrl(){let e=n.env.NEXT_PUBLIC_SERVER_URL;return e?e.includes("/.netlify/functions")?e.replace("/.netlify/functions",""):e:"https://abstractalgorithms-server.netlify.app"}async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(this.getServerUrl(),"/.netlify/functions/").concat(e);console.log("\uD83C\uDF10 Making request to:",r),console.log("\uD83D\uDD27 Environment:","production"),console.log("\uD83D\uDD17 Server URL:",this.getServerUrl());let n=await fetch(r,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(!n.ok)throw console.error("❌ Server request failed:",n.status,n.statusText),Error("Server request failed: ".concat(n.statusText));return n.json()}async getUserProfile(e,t){try{let r={};t&&(r.Authorization="Bearer ".concat(t));let n=await this.makeRequest("firebase-auth?uid=".concat(e),{method:"GET",headers:r});if(n.success&&n.user)return{...n.user,createdAt:new Date(n.user.createdAt),updatedAt:new Date(n.user.updatedAt)};return null}catch(e){return console.error("Error fetching user profile:",e),null}}async updateUserProfile(e,t,r){try{return(await this.makeRequest("firebase-auth",{method:"PUT",headers:{Authorization:"Bearer ".concat(r)},body:JSON.stringify({uid:e,updateData:{...t,updatedAt:new Date().toISOString()}})})).success}catch(e){return console.error("Error updating user profile:",e),!1}}async listUsers(e){try{let t=await this.makeRequest("firebase-auth?action=list_users",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});if(t.success&&t.users)return t.users.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}));return[]}catch(e){return console.error("Error listing users:",e),[]}}async updateUserRole(e,t,r){try{return(await this.makeRequest("firebase-auth",{method:"PUT",headers:{Authorization:"Bearer ".concat(r)},body:JSON.stringify({uid:e,role:t,updateData:{role:t,updatedAt:new Date().toISOString()}})})).success}catch(e){return console.error("Error updating user role:",e),!1}}async createUserProfile(e,t,r){try{return(await this.makeRequest("firebase-auth",{method:"POST",headers:{Authorization:"Bearer ".concat(r)},body:JSON.stringify({uid:e,...t,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})})).success}catch(e){return console.error("Error creating user profile:",e),!1}}async deleteUser(e,t){try{return(await this.makeRequest("firebase-auth?uid=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).success}catch(e){return console.error("Error deleting user:",e),!1}}}let s=new o}},function(e){e.O(0,[4358,139,244,5973,5605,2971,2117,1744],function(){return e(e.s=24132)}),_N_E=e.O()}]);