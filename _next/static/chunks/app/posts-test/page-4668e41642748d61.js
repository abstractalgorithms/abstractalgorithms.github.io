(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4152],{76564:function(e,t,s){Promise.resolve().then(s.bind(s,60239))},60239:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var r=s(57437),a=s(84603),n=s(2265);class l{getServerUrl(){let e="https://splendid-sfogliatella-6bc915.netlify.app";if(console.log("\uD83D\uDD0D POSTS SERVICE ENV URL:",e),e){let t=e.includes("/.netlify/functions")?e.replace("/.netlify/functions",""):e;return console.log("\uD83C\uDF10 Posts service using URL:",t),t}let t="https://abstractalgorithms-server.netlify.app";return console.log("⚠️ Posts service using fallback URL:",t),t}async makeRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s="".concat(this.getServerUrl(),"/.netlify/functions/").concat(e);console.log("\uD83C\uDF10 Making posts request to:",s);let r=await fetch(s,{...t,headers:{"Content-Type":"application/json",...t.headers}});if(!r.ok)throw Error((await r.json().catch(()=>({error:r.statusText}))).error||"Server request failed: ".concat(r.statusText));return r.json()}async getPosts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;try{let s=new URLSearchParams;e.limit&&s.append("limit",e.limit.toString()),e.skip&&s.append("skip",e.skip.toString()),void 0!==e.published&&s.append("published",e.published.toString()),e.sortBy&&s.append("sortBy",e.sortBy),e.sortOrder&&s.append("sortOrder",e.sortOrder),e.tags&&e.tags.length>0&&s.append("tags",e.tags.join(",")),e.author&&s.append("author",e.author),e.search&&s.append("search",e.search);let r={};t&&(r.Authorization="Bearer ".concat(t));let a=await this.makeRequest("posts?".concat(s.toString()),{method:"GET",headers:r});return a.posts&&(a.posts=a.posts.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))),a}catch(e){return console.error("Error fetching posts:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getPostById(e,t){try{let s={};t&&(s.Authorization="Bearer ".concat(t));let r=await this.makeRequest("posts?id=".concat(e),{method:"GET",headers:s});return r.post&&(r.post={...r.post,createdAt:new Date(r.post.createdAt),updatedAt:new Date(r.post.updatedAt)}),r}catch(e){return console.error("Error fetching post by ID:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getPostBySlug(e,t){try{let s={};t&&(s.Authorization="Bearer ".concat(t));let r=await this.makeRequest("posts?slug=".concat(e),{method:"GET",headers:s});return r.post&&(r.post={...r.post,createdAt:new Date(r.post.createdAt),updatedAt:new Date(r.post.updatedAt)}),r}catch(e){return console.error("Error fetching post by slug:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async createPost(e,t){try{let s=await this.makeRequest("posts",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});return s.post&&(s.post={...s.post,createdAt:new Date(s.post.createdAt),updatedAt:new Date(s.post.updatedAt)}),s}catch(e){return console.error("Error creating post:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async updatePost(e,t){try{return await this.makeRequest("posts",{method:"PUT",headers:{Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)})}catch(e){return console.error("Error updating post:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async deletePost(e,t){try{return await this.makeRequest("posts?id=".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})}catch(e){return console.error("Error deleting post:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getMyPosts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return this.getPosts({...e,published:!1},t)}async searchPosts(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getPosts({...t,search:e})}}let o=new l;var i=s(31047),c=s(91723),d=s(94630),u=s(42208),p=s(60285),x=s(18930),h=s(92369);function m(){let{user:e,userProfile:t}=(0,a.a)(),{posts:s,loading:l,error:m,createPost:g,updatePost:b,deletePost:y,fetchPosts:f}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoFetch:t=!0,query:s={}}=e,{user:r}=(0,a.a)(),[l,i]=(0,n.useState)([]),[c,d]=(0,n.useState)(!1),[u,p]=(0,n.useState)(null),[x,h]=(0,n.useState)(null),[m,g]=(0,n.useState)(s),b=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{d(!0),p(null);let t={...s,...e};g(t);let a=r?await r.getIdToken():void 0,n=await o.getPosts(t,a);n.success&&n.posts?(e.skip&&e.skip>0?i(e=>[...e,...n.posts]):i(n.posts),h(n.pagination||null)):(p(n.error||"Failed to fetch posts"),i([]),h(null))}catch(e){p(e instanceof Error?e.message:"An unexpected error occurred"),i([]),h(null)}finally{d(!1)}},[r,s]),y=(0,n.useCallback)(async e=>{if(!r)return p("Authentication required to create posts"),!1;try{p(null);let t=await r.getIdToken(),s=await o.createPost(e,t);if(s.success)return await b(m),!0;return p(s.error||"Failed to create post"),!1}catch(e){return p(e instanceof Error?e.message:"An unexpected error occurred"),!1}},[r,b,m]),f=(0,n.useCallback)(async e=>{if(!r)return p("Authentication required to update posts"),!1;try{p(null);let t=await r.getIdToken(),s=await o.updatePost(e,t);if(s.success)return i(t=>t.map(t=>t._id===e.postId?{...t,...e,updatedAt:new Date}:t)),!0;return p(s.error||"Failed to update post"),!1}catch(e){return p(e instanceof Error?e.message:"An unexpected error occurred"),!1}},[r]),j=(0,n.useCallback)(async e=>{if(!r)return p("Authentication required to delete posts"),!1;try{p(null);let t=await r.getIdToken(),s=await o.deletePost(e,t);if(s.success)return i(t=>t.filter(t=>t._id!==e)),h(e=>e?{...e,total:e.total-1}:null),!0;return p(s.error||"Failed to delete post"),!1}catch(e){return p(e instanceof Error?e.message:"An unexpected error occurred"),!1}},[r]),N=(0,n.useCallback)(async()=>{if(!(null==x?void 0:x.hasMore)||c)return;let e=x.skip+x.limit;await b({...m,skip:e})},[x,c,b,m]),v=(0,n.useCallback)(async()=>{await b({...m,skip:0})},[b,m]);return(0,n.useEffect)(()=>{t&&b(s)},[t]),{posts:l,loading:c,error:u,pagination:x,fetchPosts:b,createPost:y,updatePost:f,deletePost:j,loadMore:N,refresh:v}}({query:{published:!1,limit:10}}),[j,N]=(0,n.useState)(!1),[v,w]=(0,n.useState)(null),[k,P]=(0,n.useState)({title:"",content:"",excerpt:"",tags:"",published:!1}),A=(null==t?void 0:t.role)==="admin"||(null==t?void 0:t.role)==="content-creator",E=async e=>{e.preventDefault();let t={title:k.title,content:k.content,excerpt:k.excerpt||void 0,tags:k.tags.split(",").map(e=>e.trim()).filter(Boolean),published:k.published};(v?await b({...t,postId:v}):await g(t))&&(P({title:"",content:"",excerpt:"",tags:"",published:!1}),N(!1),w(null))},C=e=>{P({title:e.title,content:e.content,excerpt:e.excerpt,tags:e.tags.join(", "),published:e.published}),w(e._id),N(!0)},S=async e=>{confirm("Are you sure you want to delete this post?")&&await y(e)};return e?A?(0,r.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Posts Manager"}),!j&&(0,r.jsxs)("button",{onClick:()=>N(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,r.jsx)(p.Z,{className:"w-5 h-5"}),"Create Post"]})]})}),m&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,r.jsx)("p",{className:"text-red-800",children:m})}),j&&(0,r.jsxs)("div",{className:"mb-8 bg-white rounded-lg shadow-md p-6 border",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:v?"Edit Post":"Create New Post"}),(0,r.jsxs)("form",{onSubmit:E,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,r.jsx)("input",{type:"text",value:k.title,onChange:e=>P(t=>({...t,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Content *"}),(0,r.jsx)("textarea",{value:k.content,onChange:e=>P(t=>({...t,content:e.target.value})),rows:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Excerpt"}),(0,r.jsx)("textarea",{value:k.excerpt,onChange:e=>P(t=>({...t,excerpt:e.target.value})),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Brief description of the post"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags (comma-separated)"}),(0,r.jsx)("input",{type:"text",value:k.tags,onChange:e=>P(t=>({...t,tags:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"javascript, tutorial, web development"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"published",checked:k.published,onChange:e=>P(t=>({...t,published:e.target.checked})),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,r.jsx)("label",{htmlFor:"published",className:"ml-2 block text-sm text-gray-900",children:"Publish immediately"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:v?"Update Post":"Create Post"}),(0,r.jsx)("button",{type:"button",onClick:()=>{N(!1),w(null),P({title:"",content:"",excerpt:"",tags:"",published:!1})},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition-colors",children:"Cancel"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[l&&(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Loading posts..."})]}),0===s.length&&!l&&(0,r.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No posts yet"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Create your first post to get started!"})]}),s.map(e=>(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 border",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,r.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:e.title}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>C(e),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md transition-colors",title:"Edit post",children:(0,r.jsx)(d.Z,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>S(e._id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md transition-colors",title:"Delete post",children:(0,r.jsx)(x.Z,{className:"w-4 h-4"})})]})]}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:e.excerpt}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:e.tags.map(e=>(0,r.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:e},e))}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(h.Z,{className:"w-4 h-4"}),e.authorName]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(i.Z,{className:"w-4 h-4"}),new Date(e.createdAt).toLocaleDateString()]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4"}),e.readTime," min read"]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(u.Z,{className:"w-4 h-4"}),e.views," views"]})]}),(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.published?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.published?"Published":"Draft"})]})]},e._id))]})]}):(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),(0,r.jsx)("p",{className:"text-gray-600",children:"You need admin or content-creator permissions to manage posts."})]})}):(0,r.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,r.jsxs)("div",{className:"text-center py-12",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Please sign in to manage posts"}),(0,r.jsx)("p",{className:"text-gray-600",children:"You need to be signed in to view and manage posts."})]})})}function g(){let{user:e,userProfile:t,loading:s}=(0,a.a)(),[l,o]=(0,n.useState)("pending"),[i,c]=(0,n.useState)(""),[d,u]=(0,n.useState)("");if((0,n.useEffect)(()=>{let e;let t="https://splendid-sfogliatella-6bc915.netlify.app";u(e=t?t.includes("/.netlify/functions")?t.replace("/.netlify/functions",""):t:"https://abstractalgorithms-server.netlify.app"),(async()=>{try{let s=await fetch("".concat(e,"/.netlify/functions/posts?limit=1"),{method:"GET",headers:{"Content-Type":"application/json"}});if(s.ok){var t;let e=await s.json();o("success"),c("API connection successful. Found ".concat((null===(t=e.posts)||void 0===t?void 0:t.length)||0," posts."))}else throw Error("API returned ".concat(s.status,": ").concat(s.statusText))}catch(e){o("error"),c("API connection failed: ".concat(e.message)),console.error("Posts API test failed:",e)}})()},[]),s)return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Loading authentication..."})]})});let p=(null==t?void 0:t.role)==="admin"||(null==t?void 0:t.role)==="content-creator";return(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,r.jsx)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg",children:[(0,r.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Posts API Test"}),(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Testing posts functionality and MongoDB integration"})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:["            ",(0,r.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"API Connection Test"}),(0,r.jsx)("div",{className:"space-y-2",children:(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsx)("strong",{children:"Server URL:"})," ",d||"Loading..."]})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:["pending"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),(0,r.jsx)("span",{className:"text-gray-600",children:"Testing connection..."})]}),"success"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-4 w-4 bg-green-500 rounded-full"}),(0,r.jsx)("span",{className:"text-green-700",children:i})]}),"error"===l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-4 w-4 bg-red-500 rounded-full"}),(0,r.jsx)("span",{className:"text-red-700",children:i})]})]})]}),(0,r.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Authentication Status"}),e?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Email:"})," ",e.email]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Display Name:"})," ",e.displayName||"Not set"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Role:"})," ",(null==t?void 0:t.role)||"No role assigned"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Can Create Posts:"})," ",p?"Yes":"No"]})]}):(0,r.jsx)("p",{className:"text-gray-600",children:"Not authenticated. Please sign in to test posts functionality."})]}),e&&p&&(0,r.jsxs)("div",{className:"bg-white border rounded-lg",children:[(0,r.jsx)("div",{className:"px-4 py-3 border-b border-gray-200",children:(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Posts Management"})}),(0,r.jsx)("div",{className:"p-4",children:(0,r.jsx)(m,{})})]}),e&&!p&&(0,r.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-yellow-800 mb-2",children:"Access Restricted"}),(0,r.jsxs)("p",{className:"text-yellow-700",children:["You need admin or content-creator role to access posts functionality. Current role: ",(null==t?void 0:t.role)||"No role assigned"]})]}),!e&&(0,r.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Sign In Required"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Please sign in to test posts functionality. You'll need admin or content-creator role."})]})]})]})})})}}},function(e){e.O(0,[4467,5921,731,9029,2178,3829,9198,6519,5991,4980,5598,5276,9495,3440,4956,4421,3577,7399,7085,38,4799,7856,3305,1448,9357,747,1576,4657,8212,3178,5540,1744],function(){return e(e.s=76564)}),_N_E=e.O()}]);