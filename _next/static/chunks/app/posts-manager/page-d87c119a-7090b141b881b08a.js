(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4088],{76892:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var r=s(57437),i=s(2265),a=s(17556),l=s(84603),o=s(31444);function n(){let{user:e}=(0,l.a)(),[t,s]=(0,i.useState)([]),[n,d]=(0,i.useState)(0),[c,x]=(0,i.useState)(!0),[m,g]=(0,i.useState)(null),[h,u]=(0,i.useState)(null),[w,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{e&&v(),f()},[e]);let v=async()=>{try{if(x(!0),g(null),console.log("\uD83D\uDD04 Loading views data from server..."),e){let t=await e.getIdToken(),r=await o.H.getAllViews(t);if(r.success)console.log("✅ Loaded views data from server:",r),s(r.posts||[]),d(r.totalViews||0);else throw Error(r.error||"Failed to load views data")}}catch(e){console.error("❌ Error loading views data:",e),g(e instanceof Error?e.message:"Failed to load views data")}finally{x(!1)}},f=async()=>{try{u({fileBasedDataExists:!0,fileBasedPostsCount:0,firestorePostsCount:0,migrationNeeded:!0})}catch(e){console.error("Error checking migration status:",e)}},y=async()=>{try{p(!0);let e=await o.H.migrateViews({});e.success?(alert("Migration completed! ".concat(e.message||"Views data migrated successfully.")),await f(),window.location.reload()):alert("Migration failed: ".concat(e.error))}catch(e){console.error("Migration error:",e),alert("Migration failed. Check console for details.")}finally{p(!1)}};if(c)return(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[(0,r.jsx)("div",{className:"h-6 bg-gray-200 rounded mb-4 w-48"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,r.jsx)("div",{className:"h-20 bg-gray-200 rounded"}),(0,r.jsx)("div",{className:"h-20 bg-gray-200 rounded"})]}),(0,r.jsx)("div",{className:"space-y-3",children:[1,2,3].map(e=>(0,r.jsx)("div",{className:"h-12 bg-gray-200 rounded"},e))})]})});if(m)return(0,r.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:(0,r.jsxs)("div",{className:"text-center text-gray-500",children:[(0,r.jsx)(a.bA,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),(0,r.jsx)("p",{children:"Unable to load analytics"}),(0,r.jsx)("p",{className:"text-sm text-red-500 mt-2",children:m})]})});let j=[...t].sort((e,t)=>t.views-e.views).slice(0,10),b=t.length>0?Math.round(n/t.length):0,N=t.filter(e=>e.views>0).length;return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6",children:[(null==h?void 0:h.migrationNeeded)&&(0,r.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)(a.bG,{className:"w-5 h-5 text-yellow-600 mt-0.5 mr-3"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Migration Available"}),(0,r.jsxs)("p",{className:"text-sm text-yellow-700 mt-1",children:["Found ",h.fileBasedPostsCount," posts with views data in file storage. Migrate to Firestore for better performance and reliability."]}),(0,r.jsx)("button",{onClick:y,disabled:w,className:"mt-3 px-4 py-2 bg-yellow-600 text-white text-sm rounded-md hover:bg-yellow-700 disabled:opacity-50 disabled:cursor-not-allowed",children:w?"Migrating...":"Migrate to Firestore"})]})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsxs)("h2",{className:"text-xl font-bold text-gray-900 flex items-center",children:[(0,r.jsx)(a.kl,{className:"w-5 h-5 mr-2 text-blue-600"}),"Views Analytics"]}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,r.jsx)(a.vo,{className:"w-4 h-4 mr-1"}),h?"Firestore (".concat(h.firestorePostsCount," posts)"):"Real-time data"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[(0,r.jsx)("div",{className:"bg-blue-50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-blue-600",children:"Total Views"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:n.toLocaleString()})]}),(0,r.jsx)(a.bA,{className:"w-8 h-8 text-blue-500"})]})}),(0,r.jsx)("div",{className:"bg-green-50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-green-600",children:"Posts with Views"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-900",children:N})]}),(0,r.jsx)(a.kl,{className:"w-8 h-8 text-green-500"})]})}),(0,r.jsx)("div",{className:"bg-purple-50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-purple-600",children:"Average Views"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-purple-900",children:b})]}),(0,r.jsx)(a.f,{className:"w-8 h-8 text-purple-500"})]})}),(0,r.jsx)("div",{className:"bg-orange-50 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-medium text-orange-600",children:"Total Posts"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-orange-900",children:t.length})]}),(0,r.jsx)(a.SU,{className:"w-8 h-8 text-orange-500"})]})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Top Performing Posts"}),0===j.length?(0,r.jsxs)("div",{className:"text-center text-gray-500 py-8",children:[(0,r.jsx)(a.bA,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),(0,r.jsx)("p",{className:"text-lg font-medium",children:"No views recorded yet"}),(0,r.jsx)("p",{className:"text-sm",children:"Views will appear here once visitors start reading your posts."})]}):(0,r.jsx)("div",{className:"space-y-3",children:j.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"\n                    flex items-center justify-center w-8 h-8 rounded-full text-sm font-bold\n                    ".concat(0===t?"bg-yellow-100 text-yellow-800":1===t?"bg-gray-200 text-gray-700":2===t?"bg-orange-100 text-orange-800":"bg-blue-100 text-blue-800","\n                  "),children:t+1}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.postId.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}),(0,r.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.postId}),e.lastViewed&&(0,r.jsxs)("p",{className:"text-xs text-gray-400",children:["Last viewed: ",new Date(e.lastViewed).toLocaleDateString()]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 flex-shrink-0",children:[(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"text-lg font-bold text-gray-900",children:e.views.toLocaleString()}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"views"})]}),(0,r.jsx)(a.bA,{className:"w-4 h-4 text-gray-400"})]})]},e.postId))})]}),t.length>0&&(0,r.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"View Distribution"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.filter(e=>0===e.views).length}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"No Views"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.filter(e=>e.views>0&&e.views<100).length}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"1-99 Views"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.filter(e=>e.views>=100).length}),(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"100+ Views"})]})]})]})]})}},20730:function(e,t,s){"use strict";s.d(t,{C:function(){return l}});var r=s(5978),i=s(46410);class a{async getPostViews(e){try{let s=(0,r.JU)(i.db,this.COLLECTION_NAME,e),a=await (0,r.QT)(s);if(!a.exists())return{slug:e,views:0,lastViewed:new Date().toISOString(),dailyViews:{}};{var t;let s=a.data();return{slug:e,views:s.count||0,lastViewed:(null===(t=s.lastViewed)||void 0===t?void 0:t.toDate().toISOString())||new Date().toISOString(),dailyViews:s.dailyViews||{}}}}catch(e){throw console.error("Error getting post views:",e),Error("Failed to get post views")}}async getAllPostViews(){try{let e=(0,r.IO)((0,r.hJ)(i.db,this.COLLECTION_NAME),(0,r.Xo)("count","desc")),t=await (0,r.PL)(e),s=[],a=0;return t.forEach(e=>{var t;let r=e.data(),i={slug:e.id,views:r.count||0,lastViewed:(null===(t=r.lastViewed)||void 0===t?void 0:t.toDate().toISOString())||new Date().toISOString(),dailyViews:r.dailyViews||{}};s.push(i),a+=i.views}),{posts:s,totalViews:a}}catch(e){throw console.error("Error getting all post views:",e),Error("Failed to get all post views")}}async incrementPostViews(e){try{let t=(0,r.JU)(i.db,this.COLLECTION_NAME,e),s=r.EK.now(),a=new Date().toISOString().split("T")[0],l=await (0,r.QT)(t);if(l.exists()){let i=l.data(),o=i.dailyViews||{};o[a]=(o[a]||0)+1;let n=new Date;n.setDate(n.getDate()-30);let d=n.toISOString().split("T")[0];return Object.keys(o).forEach(e=>{e<d&&delete o[e]}),await (0,r.r7)(t,{count:(0,r.nP)(1),lastViewed:s,dailyViews:o,updatedAt:s}),{slug:e,views:(i.count||0)+1,lastViewed:s.toDate().toISOString(),dailyViews:o}}{let i={[a]:1};return await (0,r.pl)(t,{count:1,lastViewed:s,dailyViews:i,createdAt:s,updatedAt:s}),{slug:e,views:1,lastViewed:s.toDate().toISOString(),dailyViews:i}}}catch(e){throw console.error("Error incrementing post views:",e),Error("Failed to increment post views")}}async getAnalytics(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;try{let{posts:t,totalViews:s}=await this.getAllPostViews(),r=new Date().toISOString().split("T")[0],i=0,a={};t.forEach(e=>{e.dailyViews&&(i+=e.dailyViews[r]||0,Object.entries(e.dailyViews).forEach(e=>{let[t,s]=e;a[t]=(a[t]||0)+s}))});let l=[];for(let t=e-1;t>=0;t--){let e=new Date;e.setDate(e.getDate()-t);let s=e.toISOString().split("T")[0];l.push({date:s,views:a[s]||0})}let o=t.slice(0,10);return{totalViews:s,viewsToday:i,topPosts:o,dailyTrend:l}}catch(e){throw console.error("Error getting analytics:",e),Error("Failed to get analytics")}}async migrateFromFileData(e){try{let t=[];for(let[s,a]of Object.entries(e)){let e=(0,r.JU)(i.db,this.COLLECTION_NAME,s),l={count:a.count||0,lastViewed:a.lastViewed?r.EK.fromDate(new Date(a.lastViewed)):r.EK.now(),dailyViews:a.dailyViews||{},createdAt:r.EK.now(),updatedAt:r.EK.now()};t.push((0,r.pl)(e,l))}await Promise.all(t),console.log("Successfully migrated ".concat(t.length," posts to Firestore"))}catch(e){throw console.error("Error migrating data to Firestore:",e),Error("Failed to migrate data to Firestore")}}constructor(){this.COLLECTION_NAME="post-views"}}let l=new a},30215:function(e,t,s){"use strict";function r(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}function i(e){var t,s,r,i,a;let l=[];return(null===(t=e.title)||void 0===t?void 0:t.trim())||l.push("Title is required"),(null===(s=e.content)||void 0===s?void 0:s.trim())||l.push("Content is required"),(null===(r=e.excerpt)||void 0===r?void 0:r.trim())||l.push("Excerpt is required"),(null===(i=e.author)||void 0===i?void 0:i.trim())||l.push("Author is required"),e.date||l.push("Date is required"),e.series&&((null===(a=e.series.name)||void 0===a?void 0:a.trim())||l.push("Series name is required when adding to series"),(!e.series.order||e.series.order<1)&&l.push("Series order must be a positive number"),(!e.series.total||e.series.total<1)&&l.push("Series total must be a positive number"),e.series.order>e.series.total&&l.push("Series order cannot be greater than total parts")),{isValid:0===l.length,errors:l}}s.d(t,{CT:function(){return i},GD:function(){return r}})}},function(e){e.O(0,[4467,731,9029,2178,3829,209,7240,5991,4980,5598,5276,9495,3440,4956,4421,3577,7399,7085,38,4799,7856,3305,1448,9357,747,1576,4657,8212,3178,5540,607,1744],function(){return e(e.s=43427)}),_N_E=e.O()}]);