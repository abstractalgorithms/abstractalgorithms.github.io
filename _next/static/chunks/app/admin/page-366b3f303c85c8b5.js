(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{75984:function(e,s,a){Promise.resolve().then(a.bind(a,70575))},70575:function(e,s,a){"use strict";let t;a.r(s),a.d(s,{default:function(){return T}});var l=a(57437),r=a(2265),i=a(84603),n=a(76505),d=a(99764),c=a(98646),o=a(27648),m=a(31047),x=a(65302),h=a(98617),u=a(2207),g=a(42208),p=a(48736),b=a(90740),j=a(89345),N=a(73247),f=a(98728),v=a(49663),w=a(95805),y=a(45131),A=a(738),D=a(17292),S=a(40257);let k={apiKey:"AIzaSyCkkUj8ZGtALzwKQo8ImVAAnnhGYL6qs_4",authDomain:"abstractalgorithms-3d9d6.firebaseapp.com",projectId:"abstractalgorithms-3d9d6",databaseURL:S.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL||"https://dummy-project-default-rtdb.firebaseio.com/"},C=!!S.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL;try{t=(0,A.C6)().length?(0,A.C6)()[0]:(0,A.ZF)(k)}catch(e){console.warn("⚠️ Firebase initialization failed in getViewerCount:",e),t=null}async function Z(){if(!C||!t)return console.log("⚠️ Firebase not configured or running in build time, returning mock viewer count"),0;try{let e=(0,D.N8)(t),s=(0,D.iH)(e,"stats/viewerCount"),a=await (0,D.U2)(s);if(a.exists())return a.val();return 0}catch(e){return console.error("Error fetching viewer count:",e),0}}var E=a(4003),U=a(62189);function T(){var e,s,a,t,A,D,S;let{user:k,userProfile:C,loading:T}=(0,i.a)(),[L,_]=(0,r.useState)([]),[R,F]=(0,r.useState)([]),[I,B]=(0,r.useState)(!0),[M,z]=(0,r.useState)(""),[P,V]=(0,r.useState)("all"),[G,O]=(0,r.useState)(null),[q,H]=(0,r.useState)(!1),[K,W]=(0,r.useState)(!1),[X,Y]=(0,r.useState)(null),[Q,J]=(0,r.useState)(0),[$,ee]=(0,r.useState)(0),[es,ea]=(0,r.useState)(0),[et,el]=(0,r.useState)(null);(0,r.useEffect)(()=>{console.log("\uD83D\uDD0D Admin page useEffect triggered:",{userProfile:null==C?void 0:C.email,user:null==k?void 0:k.email,loading:T,hasUser:!!k,hasUserProfile:!!C}),T||er()},[T]),(0,r.useEffect)(()=>{let e=L;M&&(e=e.filter(e=>e.email.toLowerCase().includes(M.toLowerCase())||e.displayName&&e.displayName.toLowerCase().includes(M.toLowerCase()))),"all"!==P&&(e=e.filter(e=>e.role===P)),F(e)},[L,M,P]),(0,r.useEffect)(()=>{J(Object.keys(c.R0).length),Z().then(ee),k&&k.getIdToken().then(async e=>{try{let s=await (0,E.h)(e);ea(s);let a=await U.A.getSubscriptionAnalytics(e);el(a)}catch(e){console.error("Failed to fetch subscription data:",e)}})},[T,k]);let er=async()=>{try{if(B(!0),Y(null),console.log("\uD83D\uDD04 Loading users from server..."),k)try{let e=await k.getIdToken(),s=await d.G.listUsers(e);console.log("✅ Loaded users from server:",s),_(s);return}catch(e){console.warn("⚠️ Server unavailable, using mock data for testing:",e)}console.log("\uD83D\uDD04 Creating fallback mock users...");let e=(null==k?void 0:k.email)||"admin@test.com",s=e.includes("admin")||e.includes("test"),a=[{uid:(null==k?void 0:k.uid)||"mock-admin-1",email:e,displayName:(null==k?void 0:k.displayName)||"Admin User",role:s?"admin":"user",createdAt:new Date,updatedAt:new Date},{uid:"mock-user-1",email:"user1@example.com",displayName:"Test User 1",role:"user",createdAt:new Date,updatedAt:new Date},{uid:"mock-user-2",email:"editor@example.com",displayName:"Test Editor",role:"content-creator",createdAt:new Date,updatedAt:new Date},{uid:"mock-user-3",email:"admin2@example.com",displayName:"Test Admin 2",role:"admin",createdAt:new Date,updatedAt:new Date}];_(a)}catch(e){console.error("❌ Error loading users:",e),Y(e instanceof Error?e.message:"Failed to load users")}finally{B(!1)}},ei=async(e,s)=>{try{if(W(!0),console.log("\uD83D\uDD04 Updating user role:",{uid:e,newRole:s}),!k)throw Error("Not authenticated");let a=await k.getIdToken();await d.G.updateUserRole(a,e,s),console.log("✅ User role updated successfully"),_(a=>a.map(a=>a.uid===e?{...a,role:s,updatedAt:new Date}:a)),H(!1),O(null)}catch(a){console.error("❌ Error updating user role:",a),a instanceof Error&&a.message.includes("Failed to fetch")?(console.log("⚠️ Server unavailable, updating role locally for testing"),_(a=>a.map(a=>a.uid===e?{...a,role:s,updatedAt:new Date}:a)),H(!1),O(null)):Y(a instanceof Error?a.message:"Failed to update user role")}finally{W(!1)}},en=e=>{switch(e){case"admin":return(0,l.jsx)(h.Z,{className:"w-5 h-5 text-purple-600"});case"content-creator":return(0,l.jsx)(u.Z,{className:"w-5 h-5 text-blue-600"});default:return(0,l.jsx)(v.Z,{className:"w-5 h-5 text-gray-600"})}},ed=e=>{switch(e){case"admin":return"bg-purple-100 text-purple-800 border-purple-200";case"content-creator":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return T||I?(console.log("⏳ Admin page in loading state:",{loading:T,loadingUsers:I}),T&&!I)?(0,l.jsx)(n.Z,{title:"Authenticating",description:"Please wait...",children:(0,l.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Authenticating..."})]})})}):(0,l.jsx)(n.Z,{title:"Loading Users",description:"Fetching user data...",children:(0,l.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Loading users..."})]})})}):(null==C?void 0:C.role)==="admin"||(null==k?void 0:null===(e=k.email)||void 0===e?void 0:e.includes("admin"))||(null==k?void 0:null===(s=k.email)||void 0===s?void 0:s.includes("test"))?(0,l.jsx)(n.Z,{title:"Admin Dashboard",description:"Manage users, content, and platform settings",children:(0,l.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Dashboard"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Manage users, content, and platform settings"})]}),X&&(0,l.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(y.Z,{className:"w-5 h-5 text-red-600"}),(0,l.jsx)("p",{className:"text-red-800",children:X})]})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-6 mb-8",children:[(0,l.jsx)(o.default,{href:"/admin/users",className:"block",children:(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(w.Z,{className:"w-8 h-8 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:L.length}),(0,l.jsx)("p",{className:"text-gray-600",children:"Total Users"})]})]})})}),(0,l.jsx)(o.default,{href:"/discover",className:"block",children:(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(p.Z,{className:"w-8 h-8 text-green-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:Q}),(0,l.jsx)("p",{className:"text-gray-600",children:"Series"})]})]})})}),(0,l.jsx)(o.default,{href:"/posts",className:"block",children:(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(u.Z,{className:"w-8 h-8 text-blue-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:L.filter(e=>"content-creator"===e.role).length}),(0,l.jsx)("p",{className:"text-gray-600",children:"Content Creators"})]})]})})}),(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(h.Z,{className:"w-8 h-8 text-purple-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:L.filter(e=>"admin"===e.role).length}),(0,l.jsx)("p",{className:"text-gray-600",children:"Admins"})]})]})}),(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(j.Z,{className:"w-8 h-8 text-emerald-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:es}),(0,l.jsx)("p",{className:"text-gray-600",children:"Subscribers"})]})]})}),(0,l.jsx)(o.default,{href:"/admin/analytics",className:"block",children:(0,l.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(g.Z,{className:"w-8 h-8 text-purple-600"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:$}),(0,l.jsx)("p",{className:"text-gray-600",children:"Viewers"})]})]})})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,l.jsx)(o.default,{href:"/admin/deployment",className:"block",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)(f.Z,{className:"w-6 h-6 text-blue-600"}),(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Deployment Settings"})]}),(0,l.jsx)("p",{className:"text-gray-600",children:"Manage deployment banners and announcements"})]})}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)(p.Z,{className:"w-6 h-6 text-green-600"}),(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Content Management"})]}),(0,l.jsx)("p",{className:"text-gray-600",children:"Review and moderate user-generated content"})]}),(0,l.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,l.jsx)(g.Z,{className:"w-6 h-6 text-purple-600"}),(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Analytics"})]}),(0,l.jsx)("p",{className:"text-gray-600",children:"View platform usage and engagement metrics"})]})]}),et&&(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border mb-8",children:[(0,l.jsx)("div",{className:"p-6 border-b",children:(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Subscription Analytics"})}),(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-emerald-600 mb-1",children:(null===(a=et.analytics)||void 0===a?void 0:a.totalSubscribers)||es}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"Total Subscribers"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-blue-600 mb-1",children:(null===(t=et.analytics)||void 0===t?void 0:t.newSubscribersToday)||0}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"New Today"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-purple-600 mb-1",children:(null===(A=et.analytics)||void 0===A?void 0:A.newSubscribersThisWeek)||0}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"New This Week"})]}),(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"text-2xl font-bold text-orange-600 mb-1",children:(null===(D=et.analytics)||void 0===D?void 0:D.newSubscribersThisMonth)||0}),(0,l.jsx)("div",{className:"text-sm text-gray-600",children:"New This Month"})]})]}),(null===(S=et.analytics)||void 0===S?void 0:S.subscriptionSources)&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Subscription Sources"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Object.entries(et.analytics.subscriptionSources).map(e=>{let[s,a]=e;return(0,l.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,l.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:a}),(0,l.jsx)("div",{className:"text-sm text-gray-600 capitalize",children:s})]},s)})})]})]})]}),(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,l.jsxs)("div",{className:"p-6 border-b",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"User Management"}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsxs)("div",{className:"relative flex-1",children:[(0,l.jsx)(N.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,l.jsx)("input",{type:"text",placeholder:"Search users by email or name...",value:M,onChange:e=>z(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(b.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,l.jsxs)("select",{value:P,onChange:e=>V(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,l.jsx)("option",{value:"all",children:"All Roles"}),(0,l.jsx)("option",{value:"admin",children:"Admin"}),(0,l.jsx)("option",{value:"content-creator",children:"Content Creator"}),(0,l.jsx)("option",{value:"user",children:"User"})]})]})]})]}),(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,l.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-gray-200",children:R.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white font-medium",children:(e.displayName||e.email).charAt(0).toUpperCase()})}),(0,l.jsxs)("div",{className:"ml-4",children:[(0,l.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.displayName||"No name"}),(0,l.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[en(e.role),(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(ed(e.role)),children:e.role.replace("-"," ")})]})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(m.Z,{className:"w-4 h-4"}),e.createdAt.toLocaleDateString()]})}),(0,l.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(o.default,{href:"/admin/users/".concat(e.uid),className:"text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[(0,l.jsx)(g.Z,{className:"w-4 h-4"}),"View"]}),(0,l.jsxs)("button",{onClick:()=>{O(e),H(!0)},className:"text-purple-600 hover:text-purple-700 flex items-center gap-1",children:[(0,l.jsx)(f.Z,{className:"w-4 h-4"}),"Role"]})]})})]},e.uid))})]})}),0===R.length&&(0,l.jsxs)("div",{className:"p-8 text-center",children:[(0,l.jsx)(w.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-500",children:"No users found matching your criteria."})]})]}),q&&G&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,l.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-white font-medium",children:(G.displayName||G.email).charAt(0).toUpperCase()})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold",children:["Change Role for ",G.displayName||G.email]}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:G.email})]})]}),(0,l.jsx)("div",{className:"space-y-3 mb-6",children:["admin","content-creator","user"].map(e=>(0,l.jsxs)("button",{onClick:()=>ei(G.uid,e),disabled:K||G.role===e,className:"w-full flex items-center gap-3 p-3 rounded-lg border transition-colors ".concat(G.role===e?"bg-blue-50 border-blue-200 cursor-not-allowed":"hover:bg-gray-50 border-gray-200"),children:[en(e),(0,l.jsxs)("div",{className:"text-left",children:[(0,l.jsx)("div",{className:"font-medium capitalize",children:e.replace("-"," ")}),(0,l.jsxs)("div",{className:"text-sm text-gray-500",children:["admin"===e&&"Full access to all features and user management","content-creator"===e&&"Can create and manage content","user"===e&&"Basic user access"]})]}),G.role===e&&(0,l.jsx)(x.Z,{className:"w-5 h-5 text-blue-600 ml-auto"})]},e))}),(0,l.jsx)("div",{className:"flex gap-3",children:(0,l.jsx)("button",{onClick:()=>{H(!1),O(null)},className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:K,children:"Cancel"})}),K&&(0,l.jsxs)("div",{className:"mt-4 text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Updating role..."})]})]})})]})}):(0,l.jsx)(n.Z,{title:"Access Denied",description:"Admin access required",children:(0,l.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(y.Z,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,l.jsx)("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access the admin dashboard."}),(0,l.jsx)(o.default,{href:"/",className:"text-blue-600 hover:text-blue-700",children:"Return to Home"})]})})})}}},function(e){e.O(0,[4467,5921,731,9029,2178,3829,9198,6519,5991,4980,5598,5276,9495,3440,4956,4421,3577,7399,7085,38,4799,7856,3305,1448,9357,747,1576,4657,8212,3178,5540,1744],function(){return e(e.s=75984)}),_N_E=e.O()}]);