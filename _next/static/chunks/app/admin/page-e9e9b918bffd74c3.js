(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{5984:function(e,s,a){Promise.resolve().then(a.bind(a,3138))},3138:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return y}});var t=a(7437),l=a(2265),r=a(981),i=a(6505),n=a(9764),d=a(8646),c=a(7648),o=a(1047),m=a(5302),x=a(8617),h=a(2207),u=a(2208),p=a(8736),g=a(740),j=a(3247),N=a(8728),f=a(9663),b=a(5805),v=a(5131),w=a(8672);function y(){var e,s;let{user:a,userProfile:y,loading:D}=(0,r.a)(),[A,k]=(0,l.useState)([]),[Z,C]=(0,l.useState)([]),[S,U]=(0,l.useState)(!0),[E,L]=(0,l.useState)(""),[R,T]=(0,l.useState)("all"),[_,F]=(0,l.useState)(null),[M,P]=(0,l.useState)(!1),[O,V]=(0,l.useState)(!1),[z,G]=(0,l.useState)(null),[I,q]=(0,l.useState)(0),[B,H]=(0,l.useState)(0);(0,l.useEffect)(()=>{console.log("\uD83D\uDD0D Admin page useEffect triggered:",{userProfile:null==y?void 0:y.email,user:null==a?void 0:a.email,loading:D,hasUser:!!a,hasUserProfile:!!y}),D||Y()},[D]),(0,l.useEffect)(()=>{let e=A;E&&(e=e.filter(e=>e.email.toLowerCase().includes(E.toLowerCase())||e.displayName&&e.displayName.toLowerCase().includes(E.toLowerCase()))),"all"!==R&&(e=e.filter(e=>e.role===R)),C(e)},[A,E,R]),(0,l.useEffect)(()=>{q(Object.keys(d.R0).length),(0,w.i)().then(H)},[D]);let Y=async()=>{try{if(U(!0),G(null),console.log("\uD83D\uDD04 Loading users from server..."),a)try{let e=await a.getIdToken(),s=await n.G.listUsers(e);console.log("✅ Loaded users from server:",s),k(s);return}catch(e){console.warn("⚠️ Server unavailable, using mock data for testing:",e)}console.log("\uD83D\uDD04 Creating fallback mock users...");let e=(null==a?void 0:a.email)||"admin@test.com",s=e.includes("admin")||e.includes("test"),t=[{uid:(null==a?void 0:a.uid)||"mock-admin-1",email:e,displayName:(null==a?void 0:a.displayName)||"Admin User",role:s?"admin":"user",createdAt:new Date,updatedAt:new Date},{uid:"mock-user-1",email:"user1@example.com",displayName:"Test User 1",role:"user",createdAt:new Date,updatedAt:new Date},{uid:"mock-user-2",email:"editor@example.com",displayName:"Test Editor",role:"content-creator",createdAt:new Date,updatedAt:new Date},{uid:"mock-user-3",email:"admin2@example.com",displayName:"Test Admin 2",role:"admin",createdAt:new Date,updatedAt:new Date}];k(t)}catch(e){console.error("❌ Error loading users:",e),G(e instanceof Error?e.message:"Failed to load users")}finally{U(!1)}},J=async(e,s)=>{try{if(V(!0),console.log("\uD83D\uDD04 Updating user role:",{uid:e,newRole:s}),!a)throw Error("Not authenticated");let t=await a.getIdToken();await n.G.updateUserRole(t,e,s),console.log("✅ User role updated successfully"),k(a=>a.map(a=>a.uid===e?{...a,role:s,updatedAt:new Date}:a)),P(!1),F(null)}catch(a){console.error("❌ Error updating user role:",a),a instanceof Error&&a.message.includes("Failed to fetch")?(console.log("⚠️ Server unavailable, updating role locally for testing"),k(a=>a.map(a=>a.uid===e?{...a,role:s,updatedAt:new Date}:a)),P(!1),F(null)):G(a instanceof Error?a.message:"Failed to update user role")}finally{V(!1)}},K=e=>{switch(e){case"admin":return(0,t.jsx)(x.Z,{className:"w-5 h-5 text-purple-600"});case"content-creator":return(0,t.jsx)(h.Z,{className:"w-5 h-5 text-blue-600"});default:return(0,t.jsx)(f.Z,{className:"w-5 h-5 text-gray-600"})}},Q=e=>{switch(e){case"admin":return"bg-purple-100 text-purple-800 border-purple-200";case"content-creator":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return D||S?(console.log("⏳ Admin page in loading state:",{loading:D,loadingUsers:S}),D&&!S)?(0,t.jsx)(i.Z,{title:"Authenticating",description:"Please wait...",children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Authenticating..."})]})})}):(0,t.jsx)(i.Z,{title:"Loading Users",description:"Fetching user data...",children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading users..."})]})})}):(null==y?void 0:y.role)==="admin"||(null==a?void 0:null===(e=a.email)||void 0===e?void 0:e.includes("admin"))||(null==a?void 0:null===(s=a.email)||void 0===s?void 0:s.includes("test"))?(0,t.jsx)(i.Z,{title:"Admin Dashboard",description:"Manage users, content, and platform settings",children:(0,t.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Admin Dashboard"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Manage users, content, and platform settings"})]}),z&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.Z,{className:"w-5 h-5 text-red-600"}),(0,t.jsx)("p",{className:"text-red-800",children:z})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[(0,t.jsx)(c.default,{href:"/admin/users",className:"block",children:(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(b.Z,{className:"w-8 h-8 text-blue-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:A.length}),(0,t.jsx)("p",{className:"text-gray-600",children:"Total Users"})]})]})})}),(0,t.jsx)(c.default,{href:"/discover",className:"block",children:(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(p.Z,{className:"w-8 h-8 text-green-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:I}),(0,t.jsx)("p",{className:"text-gray-600",children:"Series"})]})]})})}),(0,t.jsx)(c.default,{href:"/posts",className:"block",children:(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(h.Z,{className:"w-8 h-8 text-blue-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:A.filter(e=>"content-creator"===e.role).length}),(0,t.jsx)("p",{className:"text-gray-600",children:"Content Creators"})]})]})})}),(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(x.Z,{className:"w-8 h-8 text-purple-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:A.filter(e=>"admin"===e.role).length}),(0,t.jsx)("p",{className:"text-gray-600",children:"Admins"})]})]})}),(0,t.jsx)(c.default,{href:"/admin/analytics",className:"block",children:(0,t.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(u.Z,{className:"w-8 h-8 text-purple-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:B}),(0,t.jsx)("p",{className:"text-gray-600",children:"Viewers"})]})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,t.jsx)(c.default,{href:"/admin/deployment",className:"block",children:(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border hover:shadow-md transition-shadow",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(N.Z,{className:"w-6 h-6 text-blue-600"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Deployment Settings"})]}),(0,t.jsx)("p",{className:"text-gray-600",children:"Manage deployment banners and announcements"})]})}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(p.Z,{className:"w-6 h-6 text-green-600"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Content Management"})]}),(0,t.jsx)("p",{className:"text-gray-600",children:"Review and moderate user-generated content"})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(u.Z,{className:"w-6 h-6 text-purple-600"}),(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Analytics"})]}),(0,t.jsx)("p",{className:"text-gray-600",children:"View platform usage and engagement metrics"})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border",children:[(0,t.jsxs)("div",{className:"p-6 border-b",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"User Management"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1",children:[(0,t.jsx)(j.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Search users by email or name...",value:E,onChange:e=>L(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(g.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsxs)("select",{value:R,onChange:e=>T(e.target.value),className:"pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,t.jsx)("option",{value:"all",children:"All Roles"}),(0,t.jsx)("option",{value:"admin",children:"Admin"}),(0,t.jsx)("option",{value:"content-creator",children:"Content Creator"}),(0,t.jsx)("option",{value:"user",children:"User"})]})]})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-200",children:Z.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white font-medium",children:(e.displayName||e.email).charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.displayName||"No name"}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[K(e.role),(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(Q(e.role)),children:e.role.replace("-"," ")})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.Z,{className:"w-4 h-4"}),e.createdAt.toLocaleDateString()]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(c.default,{href:"/admin/users/".concat(e.uid),className:"text-blue-600 hover:text-blue-700 flex items-center gap-1",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4"}),"View"]}),(0,t.jsxs)("button",{onClick:()=>{F(e),P(!0)},className:"text-purple-600 hover:text-purple-700 flex items-center gap-1",children:[(0,t.jsx)(N.Z,{className:"w-4 h-4"}),"Role"]})]})})]},e.uid))})]})}),0===Z.length&&(0,t.jsxs)("div",{className:"p-8 text-center",children:[(0,t.jsx)(b.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"No users found matching your criteria."})]})]}),M&&_&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md mx-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white font-medium",children:(_.displayName||_.email).charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold",children:["Change Role for ",_.displayName||_.email]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:_.email})]})]}),(0,t.jsx)("div",{className:"space-y-3 mb-6",children:["admin","content-creator","user"].map(e=>(0,t.jsxs)("button",{onClick:()=>J(_.uid,e),disabled:O||_.role===e,className:"w-full flex items-center gap-3 p-3 rounded-lg border transition-colors ".concat(_.role===e?"bg-blue-50 border-blue-200 cursor-not-allowed":"hover:bg-gray-50 border-gray-200"),children:[K(e),(0,t.jsxs)("div",{className:"text-left",children:[(0,t.jsx)("div",{className:"font-medium capitalize",children:e.replace("-"," ")}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["admin"===e&&"Full access to all features and user management","content-creator"===e&&"Can create and manage content","user"===e&&"Basic user access"]})]}),_.role===e&&(0,t.jsx)(m.Z,{className:"w-5 h-5 text-blue-600 ml-auto"})]},e))}),(0,t.jsx)("div",{className:"flex gap-3",children:(0,t.jsx)("button",{onClick:()=>{P(!1),F(null)},className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",disabled:O,children:"Cancel"})}),O&&(0,t.jsxs)("div",{className:"mt-4 text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"Updating role..."})]})]})})]})}):(0,t.jsx)(i.Z,{title:"Access Denied",description:"Admin access required",children:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(v.Z,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Access Denied"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"You don't have permission to access the admin dashboard."}),(0,t.jsx)(c.default,{href:"/",className:"text-blue-600 hover:text-blue-700",children:"Return to Home"})]})})})}}},function(e){e.O(0,[4467,731,9029,3829,209,7240,5991,4980,5598,5276,9495,3440,4956,4421,3577,7399,7085,38,4799,7856,3305,1448,9357,747,1576,4657,8212,8592,1744],function(){return e(e.s=5984)}),_N_E=e.O()}]);